{%extends "base.html"%}
{%block title%}
题目列表
{%endblock%}
{%block body%}
<script>
    $(document).ready(() => {
        problems = new Vue({
            delimiters: ['{[', ']}'],
            el: "#problems",
            data: {
                data: null,
                page_count: 0,
                done: false,
                current_page: 0,
                page_menu: []
            }
        });
        $.post("/api/problem_list", { page: parseInt(window.location.href.split("/").pop()) || 1 }).done(ctx => {
            ctx = JSON.parse(ctx);
            if (ctx.code) {
                show_modal_error(ctx.message);
                return;
            }
            problems.data = ctx.data;
            problems.page_count = ctx.page_count;
            problems.current_page = ctx.current_page;
            var arr = problems.page_menu;
            for (var i = 1; i <= problems.page_count; i++) problems.page_menu.push(i);
            // console.log(problems);
            // console.log(arr);
            if (arr.indexOf(problems.current_page) > 5) {
                arr.splice(1, arr.indexOf(problems.current_page) - 4);
                arr.splice(1, 1, -1);
            }
            if (arr.indexOf(problems.current_page) + 5 <= arr.length) {
                arr.splice(arr.indexOf(problems.current_page) + 5, arr.length - 2 - (arr.indexOf(problems.current_page) + 5) + 1);
                arr.splice(-2, 1, -1);
            }
            problems.done = true;


        });
    });
</script>
<div id="problems" v-if="done">
    <div class="ui header">
        <h1>Problems</h1>
    </div>
    <div class="ui stacked segment">
        <table class="ui very basic table">
            <thead>
                <tr>
                    <th class="center aligned" style="max-width: 80px;width:80px;">题目编号</th>
                    <th>题目</th>
                    <th>通过数</th>
                    <th>提交数</th>
                    <th>通过率</th>
                    <th>我的提交</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="item in data"
                    v-bind:class="{positive:item.status&&item.status=='accepted',negative:item.status&&item.status!='accepted'}">
                    <td class="center aligned" style="max-width: 80px;width:80px;">{[item.id]}</td>
                    <td style="min-width: 400px;"><a :href="'/show_problem/'+item.id">{[item.title]}</a> </td>
                    <td>{[item.accepted_submit]} </td>
                    <td>{[item.total_submit]}</td>
                    <td>{[parseInt(item.accepted_submit/item.total_submit*100)]}%</td>
                    <td><a :href="'/show_submission/'+item.submission"
                            v-if="item.submission!=-1">{[item.submission]}</a></td>
                </tr>
            </tbody>
        </table>
        <div class="ui center aligned container">
            <div class="ui pagination menu">
                <a class="item" v-for="item in page_menu" :class="{disabled:item==-1,active:item==current_page}"
                    :href="item==-1?null:('/problems/'+item)" target="__blank">{[
                    item==-1?"...":item]}</a>
            </div>
        </div>
    </div>
</div>
{%endblock%}